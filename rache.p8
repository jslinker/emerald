pico-8 cartridge // http://www.pico-8.com
version 32
__lua__

#include tables.lua
#include strings.lua

function _init()
    -- The cursor
    cX = 0
    cY = 0

    -- Grab
    grabIndex = nil

    -- The pieces
    tiles = {}
    for i=1,32 do
        add(tiles, i)
    end
    -- shuffle(tiles)
end

function _update()
    local cursorSpeed = 2
    if (btn(0)) then cX -= cursorSpeed end
    if (btn(1)) then cX += cursorSpeed end
    if (btn(2)) then cY -= cursorSpeed end
    if (btn(3)) then cY += cursorSpeed end
    if (btnp(4)) then grab() end
    if (btnp(5)) then cancel() end
end

function _draw()
    cls()
    -- -- The checker board
    -- for i=0,8 do
    --     local step = min(i*16, 127)
    --     line(step,0,step,64,7)
    -- end
    -- for i=0,4 do
    --     local step = min(i*16, 127)
    --     line(0,step,128,step,7)
    -- end
    -- Text
    local textY = 68
    print("\"there's something painted in", 8, textY, 7)
    print("ichor on the wall. maybe you", 8, textY + 8, 7)
    print("can make sense of it.\"", 8, textY + 16, 7)

    print("PRESS \151 TO SWAP TILES", 8, textY + 32, 2)
    print("PRESS return TO LEAVE", 8, textY + 40, 2)
    

    -- The tiles
    for i=1,#tiles do
        local sprite = spriteFor(i)
        if i == grabIndex then 
            
        else
            local x = flr((i - 1) % 8)
            local y = flr((i - 1) / 8)
            spr(sprite, x * 16, y * 16, 2, 2)
        end
    end

    -- The cursor
    if cY < 64 then
        local x = flr(cX / 16) * 16
        local y = flr(cY / 16) * 16
        rect(x, y, x + 16, y + 16, 8)
    end
    
    if grabIndex == nil or cY > 64 then
        spr(1,cX,cY)
    else
        local sprite = spriteFor(grabIndex)
        rectfill(cX - 1, cY - 1, cX + 16, cY + 16, 1)
        spr(sprite, cX, cY, 2, 2)
        spr(2,cX,cY)
    end
end

function solved()
    local prev = -1
    for x in all(tiles) do
        if x < prev then
            return false
        else
            prev = x
        end
    end
    return true
end

function spriteFor(i)
    local tileIndex = tiles[i] - 1
    local rowSkip = flr(tileIndex / 8) * 16
    return 16 + (tileIndex * 2) + rowSkip
end

function grab()
    local x = flr(cX / 16)
    local y = flr(cY / 16)
    local index = (x + (y * 8)) + 1

    -- Don't got out of bounds
    if index > #tiles then
        return
    end

    -- Pickup or Drop
    if grabIndex == nil then 
        grabIndex = index
    else
        swap(tiles, grabIndex, index)
        grabIndex = nil

        -- If dropping, see if the puzzle is solved
        if solved() then
            printh("You did it!")
        end
    end
end

function cancel()
    grabIndex = nil
end

__gfx__
00000000007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070700076767600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000707777700677777600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777676700776767600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077676700776767000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777700077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000666000006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111222222223333333381818d868d8d8d8d8d868f8ddd666666dd6d6dddd1d1dddd6dddd6d666665ddddd66d1ddd5dd1ddddddddd6d6d66677766766666
11111111222222223333333366d6ddd6d8d66666d8d8d6dbdbdff67dddd6ddddd66661dd5ddddd66666666dddddddd1dd1dddbbbbbbbbd66666bbbbbfff6666d
111111112222222233333333d1dd1d6666d666dddd6666bbbbb6666ddddddd11ddddddddddd5d666666666ddbbbbbbbbbbbbbbbbbbbbbbbb76b6fbbbffb66666
111111112222222233333333bbddddddddd6dd11dddddbbbbbbbbbdd5ddd5ddddddd11ddd1dd6d666f6bbbbbbbbbbbbbbbbb333bbbbb33bbbbbbbbbbbffb666f
111111112222222233333333bbbbb66667ddddddd6ddbbbbbbbbbbbbbbbb1bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb333bbbbb33bbb76bffbbffbb6b77
111111112222222233333333bbbbbbbf766d6d11dbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb6bbbbbbbfbbabbbfb76b
111111112222222233333333bbbbbbabbbbbbbbdbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbfbfffbb6b
111111112222222233333333bbbbbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb663333333bbbbfbbfbb666
444444445555555566666666bbbbbbbbbbbbbbbbbbbbbbbdbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb333bbbbb3333333333333333333babbbfbfbb66
444444445555555566666666bbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb33333bbb33333333333333333333bbbbbfbbbfbb
444444445555555566666666b33bbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb33333bbb33333333333333333333bbbbbbb66b66
444444445555555566666666b33bbbbbbbbbbbbbbb333bbbbbbbbbbbbbbbbbbbbbbb3333333bbbd333bbbbbb33333bb63333333333333333333bbbbbbfbbfff6
444444445555555566666666bbbbbbbbbbbbbbbbbb3333bbbbbbbbbbbbbbbbbbbb3333333333bd33333bbbbb333333bb333333333333333bbbbbbbbbbbbbfba6
444444445555555566666666bbbbbbbbbbbbbbbbbb3333bbbbbbbbbbbbbbbbbbb33333333333b633333bbbbb333333bb333333bbbbbbbbbbbbbbbbbbfbbbfbbb
444444445555555566666666bbbbbbbbbbbbbbbbbb3333bbbbbbbbbbbbbbbbbb333333333333bb333333bbbbb33333bb333333bbbbbbbbbbbbbbbbabbbbbaafb
444444445555555566666666bbbbbbbbbbbbbbbbbb33333bbbbbbbbbbbbbbbb333333333333bbb333333bbbbb333333bd333333bbbbbbbbbbbbbbb33bbbbbbb6
ddd6bbbbbbbbbbbbb333bbbbbbbbbbbbbbbbbbbbbb33333bbbbbbbbbbbbbbb63333333bbbbbbbb333333bbbbb333333b6333333bbbbbbbbbbbbbbb33bbbbbbb6
dd6dbbbbbbbbbbbb333333333333333bbbbbbbbbbb3333333bbbbbbbbbbbbb3333333bbbbbbbbbb33333bbbbb333333bb333333bbbbbbbbbbbbbbbbbbafb66b6
6d6bbbbbbbbbbbb3333333333333333333bbbbbbbb33333333bbbbbbbbbbbd333333bbbbbbbbbbb333333bbbbb333333bd333333333333333bbbbbbbbbbd66bb
d56bdbbbbbbbbbd33333333333333333333bbbbbbb333333333bbbbbbbbbb3333333bbbbbbbbbbb333333bbbbb333333bd3333333333333333bbbbbfbbb7bbbb
ddbbbbbbbbbbbb3333333333333333333333bbbbbb3333333333bbbbbbbb3333333bbbbbbbbbbbbb33333bbbbb333333363333333333333333bbbbbbb6bbbbb6
661bbbbbbbbbbb33333333333333333333333bbbbb3333333333bbbbbbbb333333bbbbbbbbbbbbbb333333bb33333333333333333333333333bbbbbb6666bbbd
dbbbbbbbbbbbbb33333bbbbbbbbb333333333bbbbb33333333333bbbbbbb333333bbbbbbbbbbbbbb333333333333333333333333333333333bbdbbbdbbddbddd
dbbbbbbbbbbbbb33333bbbbbbbbbbbb333333bbbbb3333333333333bbbbb33333bbbbbbbbbbbbbbb333333333333333333d33333ddddbbbbbbbbbb3336bbbdd6
bbbbdbbbbbbbbb333333bbbbbbbbbbbb33333bbbbb33333333333333bbbb33333bbbbbbbbbbbbbbbb3333333333333333bb333333dbbbbbbbbbbbb333dbbddbd
ddbbbbbbbbbbbb333333bbbbbbbbbbbb33333bbbbb333333333333333bbb33333bbbbbbb33bbbbbbb3333333333333333bb333333bbbbbbbbbbbbb3333ddbbbb
bbbd6bbbbbbbbb333333bbbbbbbbbbb333333bbbbbb33333b333333333bb33333bbbbbbb33bbbbbbb3333333333b333333b333333bbbbbbbbbbbb63333bbbb6d
66bb6bbbbbbbbbb33333bbbbbbbbbbb333333bbbbbb33333bbb3333333bb333333bbbbbbbbbb333bbb333333bbbb333333bd333333bbbbbbbbbbbdb56bb6b6d6
bbbbbbbbbbbbbbb333333bbbbbbbbb3333333bbbbbb333333bbb3333333b333333bbbbbbbbb33333bb333333bbbb333333bd333333bbbbbbbbbbbbbdb6bbb66d
bbd6bbbbbbbbbbb333333bbbbbbbb3333333bbbbbbb333333bbb13333333b333333bbbbbbbb33333bbb333333bbbb33333bb333333bbbb333333bbbbb6bb6bd1
66bbbbbb6bbbbbbb333333bbbbbb33333333bbbbbbb333333bbbb63333333333333bbbbbbbb33333bbb333333bbbb333333bd3333333333333333bbbbbb66dbb
dbdbdbbbbdbbbbbb333333bbbbbb3333333bbbbbbbbb33333bbbbb33333333333333bbbbbbb33333bbb333333bbbb333333bd3333333333333333bbbbb6bdddd
656bbbbbbbb333bb333333bbbb33333333bbbbbbbbbb333333b33333333333333333bbbbbb333333bbbb33333bbbb3333333d3333333333333333bbb6bbb6b6d
6766bdbbbbb333bbb33333333333333333bbbbbbbbbb333333333333333333333333333333333333bbbb333333bbbb333333d333333333333333bbbbb6bbdd6d
d665dbb1bbb333bbb333333333333333333bbbbbbbbb333333333333333333b33333333333333333bbbb333333bbbb333333b333333333333bbbbbbbbbbbb511
ddd1ddddbbbb33bbb3333333333333333333bbbbbbbbb3333333333333333333333333333333333bbbbb333333bbbbb33333b6333333bbbbbbbbbbbbbbbb1551
d11d7dd65bbbbbbbbb333333333333333333bbbbbbbbb33333333333b333333b33333333333333bbbbbbb33333bbbbb33333bbbbbbbbbbbbbbbbbbbb1bbb1111
1ddddddd16bbbbbbbb33333333333b3333333bbbbbbbb333333333bbbb33333bb333333333333bbb33bbb33333bbbbbb3336bbbbbbbbbbbbbbbbbbbbbbb11111
d666665ddbbbbbbbbb33333330bbbbb3333333bbbbbbb33333bbbbbbbb333333bbbbbd33333bbbbb33bbbb333bbbbbbbbbb6bbbbbbbbbbbbbbbbbbbbbb101111
66666666d6dbbbbdbb333333bbbbbbbb333333bbbbbbb33333bbbbbbbb333333bbbbbbbbbbbbbbbbbbbbbbb6bbbbbbbbbbb6bbbbbbbbbbbbbbbbbbbbdb111011
dddd6dd666bd6bbdbbb333333bbbbbbb333333bbbbbbb33333bbbbbbbb333333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbd6bbbbbbbbbbbbbbbbbbbb1111115
ddddddd6dddbbbbbbbd333333bbbbbbbb333333bbbbbb33333bbbbbbbbb33333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb6bbbbbbbbbbbbbd1bbbb11111111
d1ddd16d66d6bb6bbbb333333bbbbbbbb3333333bbbbb33333bbbbbbbbbb333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbdbbbbbbbbbbbb101111111111111
d6d6dddd5d6ddb6bbbbb33333bbbbbbbbb3333333bbbb33333bbbbbbbbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111111111111111
ddddddd1dd5d6dbbbbbb333333bbbbbbbb33333333bbb33333bbbbbbbbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111115111151511551
11d1dd66ddb6d5bbbbbb333333bbbbbbbbb3333333bbb33333bbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb1111111551151111111
dd511d1d66dd1dbbbbbb3333333bbbbbbbbb333333bbbb333bbbbbbbbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbb5dbb11bbbbbbb1111115d111111151511
d111d1dd1bbd6d6bbbbbb333333bbbbbbbbbb33333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb111015bb511bbbbbb555551d1d51151511111
11dd5dd5db5b11ddbbbbb333333bbbbbbbbbb33333bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb333b01111111bb111d1dbb111511111d1511511111d
0010111111b11111bbbbbb33333bbbbbbbbbb33333bbbbbbbbb5bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb333111111101b11111511d15dd1d11511515111111d
11111111bbbbb1011bbbbbb3333bbbbbbbbbbb333bbbbbbbbb015bbbbbbbbbbbbbbbbbbbb33bbbbbbbbbbbd1111115d111111111d1dd1551115d1d1151115111
011151115b1bbb111bbbbbbbb33bbbbbbbbbbbb33bbbbbbbbbb1bbbbbbbbbbbbbbbbbbbbb33bbbbbbbbbbb55515515d11111511d1551dd1111dddd1d55511151
11115111001b1b511bbbbbbbb33bbbbbbbbbbbb33bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb555bb11111155111511111d55111d11dd5dd1015515
0111000111b11bb51bb100bbb33bbbbbbbbbbbb33bbbbbb0111bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb01bbbd1111111d55d551d1d15015d05011d151111111
111111111b1b1b1b1bb1100bb33bbb33bbbbbbb33bbbb1555551bbbbbb11bbbbbbbbbbbbbbbbbbbbbbbb55bbbbdd1011d1d1d11d1d1bbd1d1d0d1515111ddd55
011b1111bbbbbb151bb1100bbbbbbb33bbbbbbb33bbb51151551bbbbb1515bbbbbbbbbbb1d50dbbbbbb111555bbbbbd1d1111111115b5111155111111555d555
001111015b5bbbb11bb1b0bbbbbbbbbbbbbbbbbbbbb111111110bbbbb55151b1bbbbbbdd55001bbbbbb511d155bbbd51111111011111111d51111111115511d5
0001b115111b1bb00bb1b0bbbbbbbbbbbbbbbbbbb11111111111bbbbb1505bbbbbbbb01111061bbbbbb1111111d1d115155151110111d5d11dd51155115d1110
00111b00011111bb5bb10100bbbbbbbbbbbbbbbbb5555051511551bb1115551bbbbb101555105bbbbbb111111011151d11115155155555515111155015551dd5
11111b110111bbb11bb10100000bbbbbbbbbbbbbb51115555d151111111d5555bbb000b155dd1dbbbb515d5151110111515515515dd51111111d551105111111
11155515111111110bb50010000bbbb33bbbbbbbb15511551d51550101d551515b500b515b15dd5bbd5515551151510015115d115dd1111111511511511dd110
11155b11111111101bbd0b00010bbbb33bbbbbbb0555511111511d010d15151551151100b010111bb1011101151515511111115551d1115d5115511110d15511
11111111501111551bb110bbb00bbbbbbbbbbbb0b15111115501111111100150111111111111111bb1111111111010011111115515d11115dd51155111111551
11111111111005151bb11001010bbbbbbbbbbbb000111151111111100166511101551110115d101bb1d011011110015501011111111515111dd1555101111511
1111b1b1111115111bb11000000bbbbbbbbbbbb000b0110111111111010111111151101011d5111bb1d1110111110155111101111111551111dd1515111111d1
5111111011111b11bbb11011001bbbbbbbb0bb000b0101101011101111111011111110111111b11bb1111111b01111b100011010111101111111110110011100
111111111111bbb01bb0100100bbbbbbbbb000010b01011010000550115515011111551b1111b11bb1111111110b001b1101b011100100001111111111000000
11151111111110b00bb000000000bbbbbbb000000001110011111511d5115111111015b11111111bb11111d01111101010001051105010111111111111110111
11011111111111111bb11001000b1bbbbb000000000110551101001115115111511110151511011bb10111511100100111111001000050111111000011111111
11111111b11111111bb100b00000bbbbb0000000000105115515100511111111111110511555111bb11111011100100001111100100000011110000011111111
111111111d111115bbb50010000000bb0010100000001555d555511010515011111111110015111bb11111111111000001100000000011111110011011011111
100111110501010111510000000000011000001000000005551510111111111111111111101d1555511111111110000000111000100000100011111100000000
11111110111101111111001000000000110000000000011155101111111111110111111111105551551111111115100000111100110011110111001000100010
11111111101111111110001000001000000000000000011111110011151115151101111111111555011111111104550111111001111111011100111001000001
11111100110000101100001000010000000000000000001110111111511115511111110111111111111111111105555100550151111115111011111001000151
111111101011101011000000000000000100000000000001110111111111111111111111111110011111111111055515555d5111051111110111110110011011
00101111110011011100000000000000100000000000000011111111101111111111111111111000001110511110111110001011111110010111110111110551
11011111111111110100000000000001100000000000000000001111101111101011111111111110101111501151115515111111111111111110111115115155
110010111111111111000000000000110000010000000000001011111011111000111101111111001011115115555d5511115111111111111100110155d11501
1101101011111111001000010000000000000000000000000011011111111101110101010111111111101050115d55515551115111111001110101111111115d
100011001111111111100001000000000001000000001000001111111001111110111011111111111110110551510111505151d1511111110011111111111151
11011111101111111110000000001000000100000000001000111111151001051101111111110011111111111110100101511110111111101511555011111015
0111101111111001111100000001100010010000000000000010111011110111111011111111010111010110011111111155515111111110d111511111111101
11110110111111011111100000000000010000000000000001111100511110101111111111110000111111111111155101051111100110011111511111510111
11111010111111011101101100001000000001010000100011011115111111111111111111111110110111001111111111111111010110001115111111111110
11001151111111011111110101111515150511011511111511111111111101111511111115111111111011111511111111111101100111101111111110011111
